<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì ì‹¤ ì§€í•˜ ë¯¸ê¶: ì´ëª… ì–´ë¥´ì‹ ì˜ ëª¨í—˜</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background-color: #2d2d2d; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Gulim', sans-serif; }
        #game-container { border: 4px solid #555; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="game-container"></div>

<script>
// 1. ê²Œì„ ì„¤ì • (Config)
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    parent: 'game-container',
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 600 }, // ì¤‘ë ¥ ì„¤ì •
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);

// ë³€ìˆ˜ ì„ ì–¸
let player;
let cursors;
let platforms;
let mushrooms;
let ingredients = 0; // ë²„ì„¯ ê°œìˆ˜
let inventoryText;
let cookText;
let isCooking = false;
let attackKey;
let cookKey;

// 2. ë¦¬ì†ŒìŠ¤ ë¡œë“œ (Preload)
function preload() {
    // ì‹¤ì œ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë¯€ë¡œ ì½”ë“œë¡œ ë„í˜•ì„ ê·¸ë¦½ë‹ˆë‹¤.
    // ë‚˜ì¤‘ì— ì´ ë¶€ë¶„ì„ ì‹¤ì œ ë„íŠ¸ ì´ë¯¸ì§€('assets/player.png')ë¡œ êµì²´í•˜ë©´ ë©ë‹ˆë‹¤.
}

// 3. ê²Œì„ ìƒì„± (Create)
function create() {
    // ë°°ê²½ (ì„ì´Œí˜¸ìˆ˜ ì§€í•˜ ëŠë‚Œì˜ ì–´ë‘ìš´ ì²­ë¡ìƒ‰)
    this.add.rectangle(400, 300, 800, 600, 0x1a2626);
    this.add.text(20, 20, 'STAGE 1: ì„ì´Œí˜¸ìˆ˜ ë°°ìˆ˜êµ¬', { fontSize: '24px', fill: '#fff' });

    // ë°”ë‹¥ ìƒì„±
    platforms = this.physics.add.staticGroup();
    let ground = this.add.rectangle(400, 580, 800, 40, 0x3e3e3e); // ë°”ë‹¥ ìƒ‰
    platforms.add(ground);

    // í”Œë ˆì´ì–´ ìƒì„± (ì´ëª… ì–´ë¥´ì‹ : ê°ˆìƒ‰ ë°•ìŠ¤)
    player = this.add.rectangle(100, 450, 40, 60, 0x8B4513); // ê°ˆìƒ‰ ëª¸
    this.physics.add.existing(player);
    player.body.setCollideWorldBounds(true);
    
    // ëª¬ìŠ¤í„° ìƒì„± (ì´ë¼ ë‚€ ë²„ì„¯: ë…¹ìƒ‰ ë°•ìŠ¤)
    mushrooms = this.physics.add.group();
    createMushroom(this, 500, 500);
    createMushroom(this, 700, 500);

    // ì¶©ëŒ ì„¤ì •
    this.physics.add.collider(player, platforms);
    this.physics.add.collider(mushrooms, platforms);

    // í‚¤ë³´ë“œ ì…ë ¥ ì„¤ì •
    cursors = this.input.keyboard.createCursorKeys();
    attackKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z); // Zí‚¤ ê³µê²©
    cookKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C);   // Cí‚¤ ìš”ë¦¬

    // UI í…ìŠ¤íŠ¸
    inventoryText = this.add.text(20, 60, 'ê°€ë°©: ë²„ì„¯ 0 / 3', { fontSize: '18px', fill: '#ffffff' });
    cookText = this.add.text(300, 200, '', { fontSize: '32px', fill: '#ffcc00', backgroundColor: '#000' });
    cookText.setOrigin(0.5);
    
    // ì¡°ì‘ ì„¤ëª…
    this.add.text(20, 550, '[â†][â†’]: ì´ë™ | [â†‘]: ì í”„ | [Z]: ì†¥ëšœê»‘ ê³µê²© | [C]: ìš”ë¦¬í•˜ê¸° (ë²„ì„¯ 3ê°œ í•„ìš”)', { fontSize: '14px', fill: '#aaa' });
}

// 4. ê²Œì„ ë£¨í”„ (Update)
function update() {
    // 1) í”Œë ˆì´ì–´ ì´ë™ ë¡œì§
    if (cursors.left.isDown) {
        player.body.setVelocityX(-200);
    } else if (cursors.right.isDown) {
        player.body.setVelocityX(200);
    } else {
        player.body.setVelocityX(0);
    }

    if (cursors.up.isDown && player.body.touching.down) {
        player.body.setVelocityY(-450); // ì í”„
    }

    // 2) ê³µê²© ë¡œì§ (Zí‚¤)
    if (Phaser.Input.Keyboard.JustDown(attackKey)) {
        attack(this);
    }

    // 3) ìš”ë¦¬ ë¡œì§ (Cí‚¤)
    if (Phaser.Input.Keyboard.JustDown(cookKey)) {
        startCooking(this);
    }
}

// ëª¬ìŠ¤í„° ìƒì„± í•¨ìˆ˜
function createMushroom(scene, x, y) {
    let mushroom = scene.add.rectangle(x, y, 30, 30, 0x00ff00); // ë…¹ìƒ‰ ë²„ì„¯
    scene.physics.add.existing(mushroom);
    mushroom.body.setCollideWorldBounds(true);
    mushroom.body.setBounce(0.2);
    mushrooms.add(mushroom);
}

// ê³µê²© í•¨ìˆ˜
function attack(scene) {
    // ê³µê²© ì´í™íŠ¸ (ì ì‹œ í•˜ì–€ìƒ‰ìœ¼ë¡œ ë²ˆì©)
    player.fillColor = 0xffffff;
    scene.time.delayedCall(100, () => { player.fillColor = 0x8B4513; }); // ì›ë˜ ìƒ‰ ë³µê·€

    // íˆíŠ¸ë°•ìŠ¤ íŒì • (í”Œë ˆì´ì–´ ì£¼ë³€ì˜ ëª¬ìŠ¤í„° í™•ì¸)
    let enemies = mushrooms.getChildren();
    enemies.forEach((enemy) => {
        if (Phaser.Geom.Intersects.RectangleToRectangle(player.getBounds(), enemy.getBounds())) {
            // ëª¬ìŠ¤í„° ì²˜ì¹˜
            enemy.destroy();
            
            // ì•„ì´í…œ íšë“ íš¨ê³¼
            ingredients += 1;
            inventoryText.setText('ê°€ë°©: ë²„ì„¯ ' + ingredients + ' / 3');
            
            // í…ìŠ¤íŠ¸ íš¨ê³¼
            let dropText = scene.add.text(player.x, player.y - 50, '+ ì´ë¼ ë²„ì„¯', { fontSize: '16px', fill: '#00ff00' });
            scene.tweens.add({ targets: dropText, y: dropText.y - 30, alpha: 0, duration: 1000, onComplete: () => dropText.destroy() });
        }
    });
}

// ìš”ë¦¬ í•¨ìˆ˜
function startCooking(scene) {
    if (ingredients >= 3) {
        // ìš”ë¦¬ ì„±ê³µ ì—°ì¶œ
        isCooking = true;
        player.body.setVelocity(0); // ì›€ì§ì„ ë©ˆì¶¤
        
        cookText.setText("ğŸ”¥ ê°€ë§ˆì†¥ ì¡°ë¦¬ ì¤‘... ğŸ”¥");
        
        scene.time.delayedCall(2000, () => {
            // 2ì´ˆ í›„ ìš”ë¦¬ ì™„ì„±
            ingredients -= 3;
            inventoryText.setText('ê°€ë°©: ë²„ì„¯ ' + ingredients + ' / 3');
            cookText.setText("ğŸ² [ë“¤ê¹¨ ë²„ì„¯íƒ•] ì™„ì„±!\ní˜ì´ ì†Ÿì•„ë‚©ë‹ˆë‹¤!");
            
            // ë²„í”„ íš¨ê³¼ (í”Œë ˆì´ì–´ê°€ ì»¤ì§)
            scene.tweens.add({
                targets: player,
                scaleX: 1.5,
                scaleY: 1.5,
                duration: 500,
                yoyo: true,
                repeat: 1
            });

            scene.time.delayedCall(2000, () => {
                cookText.setText("");
                isCooking = false;
            });
        });

    } else {
        // ì¬ë£Œ ë¶€ì¡±
        let warning = scene.add.text(player.x, player.y - 50, 'ì¬ë£Œê°€ ë¶€ì¡±í•´!', { fontSize: '16px', fill: '#ff0000' });
        scene.tweens.add({ targets: warning, y: warning.y - 30, alpha: 0, duration: 1000 });
    }
}

</script>
</body>
</html>