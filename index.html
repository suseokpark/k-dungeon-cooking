<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì ì‹¤ ì§€í•˜ ë¯¸ê¶: ì´ëª… ì–´ë¥´ì‹ ì˜ ëª¨í—˜</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background-color: #111; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Gulim', sans-serif; overflow: hidden; }
        #game-container { border: 4px solid #444; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
    </style>
</head>
<body>

<div id="game-container"></div>

<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    parent: 'game-container',
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 800 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

const game = new Phaser.Game(config);

let player;
let cursors;
let platforms;
let mushrooms;
let ingredients = 0;
let inventoryText;
let cookText;
let isCooking = false;
let attackKey;
let cookKey;

function preload() {
    // ê¹ƒí—ˆë¸Œ assets í´ë”ì— ì˜¬ë¦° ì´ë¯¸ì§€ ì´ë¦„ê³¼ ë˜‘ê°™ì•„ì•¼ í•©ë‹ˆë‹¤!
    this.load.image('bg', 'assets/bg.png');         // ë°°ê²½
    this.load.image('player', 'assets/player.png'); // ì´ëª… ì–´ë¥´ì‹ 
    this.load.image('mushroom', 'assets/mushroom.png'); // ê±·ëŠ” ë²„ì„¯
    this.load.image('soup', 'assets/soup.png');     // ì™„ì„±ëœ ìš”ë¦¬
}

function create() {
    // 1. ë°°ê²½ (í™”ë©´ ì¤‘ì•™ì— ë°°ì¹˜)
    let bg = this.add.image(400, 300, 'bg');
    bg.setDisplaySize(800, 600); // í™”ë©´ í¬ê¸°ì— ë§ê²Œ ëŠ˜ë¦¬ê¸°

    this.add.text(20, 20, 'STAGE 1: ì„ì´Œí˜¸ìˆ˜ ë°°ìˆ˜êµ¬', { fontSize: '24px', fill: '#fff', stroke: '#000', strokeThickness: 4 });

    // 2. ë°”ë‹¥ (íˆ¬ëª…í•˜ê²Œ ì²˜ë¦¬í•˜ì—¬ ë°°ê²½ì´ ë³´ì´ê²Œ í•¨)
    platforms = this.physics.add.staticGroup();
    let ground = this.add.rectangle(400, 590, 800, 20, 0x000000, 0); // íˆ¬ëª…ë„ 0
    platforms.add(ground);

    // 3. í”Œë ˆì´ì–´ (ì´ëª… ì–´ë¥´ì‹ )
    player = this.physics.add.sprite(100, 450, 'player');
    player.setBounce(0.1);
    player.setCollideWorldBounds(true);
    player.setDisplaySize(64, 64); // í¬ê¸° ì¡°ì ˆ (ë„ˆë¬´ í¬ë©´ ì¤„ì´ì„¸ìš”)

    // 4. ëª¬ìŠ¤í„° (ë²„ì„¯)
    mushrooms = this.physics.add.group();
    createMushroom(this, 500, 500);
    createMushroom(this, 650, 500);
    createMushroom(this, 750, 500);

    // ì¶©ëŒ ì„¤ì •
    this.physics.add.collider(player, platforms);
    this.physics.add.collider(mushrooms, platforms);

    // í‚¤ë³´ë“œ
    cursors = this.input.keyboard.createCursorKeys();
    attackKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);
    cookKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.C);

    // UI
    inventoryText = this.add.text(20, 60, 'ğŸ„ ë²„ì„¯: 0 / 3', { fontSize: '20px', fill: '#fff', stroke: '#000', strokeThickness: 3 });
    cookText = this.add.text(400, 300, '', { fontSize: '30px', fill: '#ffcc00', stroke: '#000', strokeThickness: 5, align: 'center' });
    cookText.setOrigin(0.5);

    this.add.text(20, 560, '[â†][â†’]: ì´ë™ | [â†‘]: ì í”„ | [Z]: ê³µê²© | [C]: ìš”ë¦¬', { fontSize: '16px', fill: '#ddd', stroke: '#000', strokeThickness: 2 });
}

function update() {
    if (isCooking) return; // ìš”ë¦¬ ì¤‘ì—” ì¡°ì‘ ë¶ˆê°€

    // ì´ë™ ë¡œì§
    if (cursors.left.isDown) {
        player.setVelocityX(-200);
        player.setFlipX(true); // ì™¼ìª½ ë³¼ ë• ì´ë¯¸ì§€ ë’¤ì§‘ê¸°
    } else if (cursors.right.isDown) {
        player.setVelocityX(200);
        player.setFlipX(false);
    } else {
        player.setVelocityX(0);
    }

    if (cursors.up.isDown && player.body.touching.down) {
        player.setVelocityY(-500);
    }

    // ê³µê²©
    if (Phaser.Input.Keyboard.JustDown(attackKey)) {
        attack(this);
    }

    // ìš”ë¦¬
    if (Phaser.Input.Keyboard.JustDown(cookKey)) {
        startCooking(this);
    }
}

function createMushroom(scene, x, y) {
    let mushroom = scene.physics.add.sprite(x, y, 'mushroom');
    mushroom.setCollideWorldBounds(true);
    mushroom.setBounce(0.5);
    mushroom.setDisplaySize(48, 48);
    // ë²„ì„¯ì´ ëœë¤í•˜ê²Œ ì›€ì§ì´ê²Œ (ê°„ë‹¨í•œ AI)
    scene.tweens.add({
        targets: mushroom,
        x: x - 50,
        duration: 2000,
        yoyo: true,
        repeat: -1,
        ease: 'Sine.easeInOut'
    });
    mushrooms.add(mushroom);
}

function attack(scene) {
    // ê³µê²© ëª¨ì…˜ (ì‚´ì§ ì•ìœ¼ë¡œ íŠ€ì–´ë‚˜ê°)
    scene.tweens.add({ targets: player, x: player.x + (player.flipX ? -20 : 20), duration: 100, yoyo: true });

    let enemies = mushrooms.getChildren();
    let hit = false;

    enemies.forEach((enemy) => {
        if (Phaser.Geom.Intersects.RectangleToRectangle(player.getBounds(), enemy.getBounds())) {
            enemy.destroy();
            ingredients += 1;
            inventoryText.setText('ğŸ„ ë²„ì„¯: ' + ingredients + ' / 3');
            hit = true;
            
            // ë°ë¯¸ì§€ í…ìŠ¤íŠ¸
            let dmg = scene.add.text(enemy.x, enemy.y - 20, 'ì¾…!', { fontSize: '20px', fill: '#ff0000', stroke:'#fff', strokeThickness:2 });
            scene.tweens.add({ targets: dmg, y: dmg.y - 40, alpha: 0, duration: 800, onComplete: () => dmg.destroy() });
        }
    });
}

function startCooking(scene) {
    if (ingredients >= 3) {
        isCooking = true;
        player.setVelocity(0);
        
        cookText.setText("ğŸ”¥ ê°€ë§ˆì†¥ ì¡°ë¦¬ ì¤‘... ğŸ”¥");
        
        // ìš”ë¦¬ ì•„ì´ì½˜ ë„ìš°ê¸°
        let pot = scene.add.image(player.x, player.y - 50, 'soup').setDisplaySize(64,64).setAlpha(0);
        scene.tweens.add({ targets: pot, alpha: 1, y: player.y - 80, duration: 1000, yoyo: true, repeat: 1 });

        scene.time.delayedCall(2500, () => {
            ingredients -= 3;
            inventoryText.setText('ğŸ„ ë²„ì„¯: ' + ingredients + ' / 3');
            cookText.setText("ğŸ² [ë“¤ê¹¨ ë²„ì„¯íƒ•] ì™„ì„±!\ní˜ì´ ì†Ÿì•„ë‚©ë‹ˆë‹¤!");
            
            // ê±°ëŒ€í™” ë²„í”„
            scene.tweens.add({
                targets: player,
                scaleX: 2.0, // ì´ë¯¸ì§€ í¬ê¸°ì— ë§ì¶° ë¹„ìœ¨ ì¡°ì •
                scaleY: 2.0,
                duration: 500,
                yoyo: true,
                hold: 2000,
                onComplete: () => {
                    cookText.setText("");
                    isCooking = false;
                    player.setDisplaySize(64, 64); // ì›ë˜ í¬ê¸°ë¡œ ë³µê·€
                }
            });
        });
    } else {
        let warning = scene.add.text(player.x, player.y - 50, 'ì¬ë£Œ ë¶€ì¡±!', { fontSize: '18px', fill: '#ff0000', stroke:'#fff', strokeThickness:2 });
        scene.tweens.add({ targets: warning, y: warning.y - 30, alpha: 0, duration: 1000 });
    }
}
</script>
</body>
</html>